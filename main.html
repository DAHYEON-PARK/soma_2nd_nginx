<!DOCTYPE html>
<html lang="en">
<head>
    <title>Soma 2nd Project</title>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Vendor CSS -->
    <link href="vendors/bower_components/animate.css/animate.min.css" rel="stylesheet">
    <link href="vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">
    <link href="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css" rel="stylesheet">

    <!-- CSS -->
    <link href="css/app.min.1.css" rel="stylesheet">
    <link href="css/app.min.2.css" rel="stylesheet">

    <!-- Javascript Libraries -->
    <script src="https://code.jquery.com/jquery-1.11.2.min.js"></script>
    
    <script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>
    <script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
    <script src="vendors/bower_components/Waves/dist/waves.min.js"></script>

<!--  right pop up
    <script src="vendors/bootstrap-growl/bootstrap-growl.min.js"></script>
    <script src="js/demo.js"></script>
-->  
    <script src="vendors/bower_components/jquery.nicescroll/jquery.nicescroll.min.js"></script>
    <script src="js/functions.js"></script>
    
    <script src="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.min.js"></script>
    
    <script src="js/crud.js"></script> 
    <script src="js/wraptalk.js"></script> 
</head>

<body>
    <header id="header">
        <ul class="header-inner">
            <!-- hamburger icon -->
            <li id="menu-trigger" data-trigger="#sidebar">
                <div class="line-wrap">
                    <div class="line top"></div>
                    <div class="line center"></div>
                    <div class="line bottom"></div>
                </div>
            </li>

            <!-- title -->
            <li class="logo hidden-xs">
                <a href="">Wrap Talk</a>
            </li>
            
            <li class="pull-right">
			<ul class="top-menu">
        <!--     like android switch btn : pop the drawer layout
				<li id="toggle-width">
					<div class="toggle-switch">
						<input id="tw-switch" type="checkbox" hidden="hidden">
						<label for="tw-switch" class="ts-helper"></label>
					</div>
				</li>
        -->
				<li id="top-search">
					<a class="tm-search" href=""></a>
				</li>
				<li class="dropdown">
					<a data-toggle="dropdown" class="tm-message" href=""><i class="tmn-counts">4</i></a>
					<div class="dropdown-menu dropdown-menu-lg pull-right">
						<div class="listview">
							<div class="lv-header">
								Messages
							</div>
							<div class="lv-body">
								<a class="lv-item" href="">
									<div class="media">
										<div class="pull-left">
											<img class="lv-img-sm" src="img/profile-pics/1.jpg" alt="">
										</div>
										<div class="media-body">
											<div class="lv-title">지영</div>
											<small class="lv-small">팀원 1</small>
										</div>
									</div>
								</a>
								<a class="lv-item" href="">
									<div class="media">
										<div class="pull-left">
											<img class="lv-img-sm" src="img/profile-pics/2.jpg" alt="">
										</div>
										<div class="media-body">
											<div class="lv-title">한별</div>
											<small class="lv-small">팀장</small>
										</div>
									</div>
								</a>
								<a class="lv-item" href="">
									<div class="media">
										<div class="pull-left">
											<img class="lv-img-sm" src="img/profile-pics/3.jpg" alt="">
										</div>
										<div class="media-body">
											<div class="lv-title">다현</div>
											<small class="lv-small">팀원 2</small>
										</div>
									</div>
								</a>
								<a class="lv-item" href="">
									<div class="media">
										<div class="pull-left">
											<img class="lv-img-sm" src="img/profile-pics/4.jpg" alt="">
										</div>
										<div class="media-body">
											<div class="lv-title">경완</div>
											<small class="lv-small">팀원 3</small>
										</div>
									</div>
								</a>
							</div>
							<a class="lv-footer" href="">View More</a>
						</div>
					</div>
				</li>
                
				<li class="dropdown">
					<a data-toggle="dropdown" class="tm-notification" href=""><i class="tmn-counts">1</i></a>
					<div class="dropdown-menu dropdown-menu-lg pull-right">
						<div class="listview" id="notifications">
							<div class="lv-header">
								Notification
								<ul class="actions">
									<li class="dropdown">
										<a href="" data-clear="notification">
											<i class="zmdi zmdi-check-all"></i>
										</a>
									</li>
								</ul>
							</div>
							<div class="lv-body">
								<a class="lv-item" href="">
									<div class="media">
										<div class="pull-left">
											<img class="lv-img-sm" src="img/profile-pics/2.jpg" alt="">
										</div>
										<div class="media-body">
											<div class="lv-title">정원용 멘토님</div>
											<small class="lv-small">프로젝트 화이팅!</small>
										</div>
									</div>
								</a>
							</div>
				
							<a class="lv-footer" href="">View Previous</a>
						</div>
				
					</div>
				</li>
				<li class="dropdown hidden-xs">
					<a data-toggle="dropdown" class="tm-task" href=""></a>
					<div class="dropdown-menu pull-right dropdown-menu-lg">
						<div class="listview">
							<div class="lv-header">
								Tasks
							</div>
							<div class="lv-body">
								<div class="lv-item">
									<div class="lv-title m-b-5">HTML5 Validation Report</div>
				
									<div class="progress">
										<div class="progress-bar" role="progressbar" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100" style="width: 95%">
											<span class="sr-only">95% Complete (success)</span>
										</div>
									</div>
								</div>
								<div class="lv-item">
									<div class="lv-title m-b-5">Google Chrome Extension</div>
				
									<div class="progress">
										<div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
											<span class="sr-only">80% Complete (success)</span>
										</div>
									</div>
								</div>
								<div class="lv-item">
									<div class="lv-title m-b-5">Social Intranet Projects</div>
				
									<div class="progress">
										<div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
											<span class="sr-only">20% Complete</span>
										</div>
									</div>
								</div>
								<div class="lv-item">
									<div class="lv-title m-b-5">Bootstrap Admin Template</div>
				
									<div class="progress">
										<div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
											<span class="sr-only">60% Complete (warning)</span>
										</div>
									</div>
								</div>
								<div class="lv-item">
									<div class="lv-title m-b-5">Youtube Client App</div>
				
									<div class="progress">
										<div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
											<span class="sr-only">80% Complete (danger)</span>
										</div>
									</div>
								</div>
							</div>
				
							<a class="lv-footer" href="">View All</a>
						</div>
					</div>
				</li>
                
				<li class="dropdown">
					<a data-toggle="dropdown" class="tm-settings" href=""></a>
					<ul class="dropdown-menu dm-icon pull-right">
						<li class="hidden-xs">
							<a data-action="fullscreen" href=""><i class="zmdi zmdi-fullscreen"></i> Toggle Fullscreen</a>
						</li>
						<li>
							<a data-action="clear-localstorage" href=""><i class="zmdi zmdi-delete"></i> Clear Local Storage</a>
						</li>
					</ul>
				</li>
			</li>
		</ul>
		
		<!-- Top Search Content -->
		<div id="top-search-wrap">
			<input type="text">
			<i id="top-search-close">&times;</i>
		</div>
    </header>

    <section id="main">
		<aside id="sidebar">
			<div class="sidebar-inner c-overflow">
				<div class="profile-menu">
					<a href="">
						<div class="profile-pic">
							<img src="img/profile-pics/1.jpg" alt="">
						</div>

						<div id="drawer_user_id" class="profile-info">
                            <i class="zmdi zmdi-arrow-drop-down"></i>
						</div>
					</a>

					<ul class="main-menu">
						<li>
							<a href="profile-about.html"><i class="zmdi zmdi-account"></i> View Profile</a>
						</li>
						<li>
							<a href=""><i class="zmdi zmdi-input-antenna"></i> Privacy Settings</a>
						</li>
						<li>
							<a href=""><i class="zmdi zmdi-settings"></i> Other Settings</a>
						</li>
						<li>
							<a href=""><i class="zmdi zmdi-time-restore"></i> Logout</a>
						</li>
					</ul>
				</div>

				<ul class="main-menu" id="menu-public">
				</ul>
			</div>
		</aside>
        
        <section id="content">
			<div id="card_table" class="container">
				<div class="block-header">
					<h2></h2>
				</div>

				<div class="card" style="display: none;">
					<div class="card-header">
						<h2>Table CRUD <small>테이블 스키마를 선택해서 데이터를 관리할 수 있습니다.</small></h2>
					</div>

					<div class="card-body card-padding">
						<form class="row" role="form">
							<div class="col-sm-5">
								<div class="form-group fg-line">
									<div class="fg-line select">
										<select class="form-control" id="sel_table_search">
											<option>USER</option>
                                            <option>SESSION</option>
											<option>APP</option>
                                            <option>APP USER LIST</option>
                                            <option>CHANNEL</option>
                                            <option>CHANNEL USER LIST</option>
                                            <option>NOTICE</option>
                                            <option>SETTING</option>
										</select>
									</div>
								</div>
							</div>

							<div class="col-sm-4">
								<button type="button" id="btn_table_search" class="btn btn-primary btn-sm m-t-5">Search</button>
							</div>
						</form>
					</div>
				</div>

				<div class="card" id="card_input" style="display: none;">
					<form class="form-horizontal" role="form">
						<div class="card-header">
							<h2>데이터 입력</h2>
						</div>
						
						<div class="card-body card-padding">
							<div class="form-group">
								<div class="col-sm-offset-2 col-sm-10">
									<button id="insertBtn" type="button" class="btn btn-primary btn-sm waves-effect">입력</button>
									<button id="updateBtn" type="button" class="btn btn-success btn-sm waves-effect">수정</button>
									<button id="deleteBtn" type="button" class="btn btn-warning btn-sm waves-effect">삭제</button>
								</div>
							</div>
						</div>
					</form>
				</div>
				
			</div>
		</section>
    </section>    
   
    
    
    
    <footer id="footer">
        Software Maestro &copy; 2015년 1단계 2차 프로젝트

        <ul class="f-menu">
            <li><a href="">Home</a></li>
            <li><a href="">Dashboard</a></li>
            <li><a href="">Support</a></li>
            <li><a href="">Contact</a></li>
        </ul>
    </footer>
</body>

<script>

function onCrud(table, json){
	//var $container = $('#content .container');
	//var $card = $('<div class="card"><div class="card-header"></div><div class="card-body"><table class="table table-striped table-bordered table-hover table-condensed"><thead></thead><tbody></tbody></table></div></div>');

	//var $container = $('#content .container');
    	var $container = $('#card_table');
    	var str = String('<h2>'+table+' <small>Show database tables for admin user.</small></h2>');
    	var table_id = 'id_'+table;
	var $card = $('<div class="card"><div class="card-header">'+str+'</div><div class="table-responsive"><table id="'+table_id+'" class="table table-striped"><thead></thead><tbody></tbody></table></div></div>');

	// setting table name 
	$card.find('.card-header').html('<h2>'+table+'</h2>');

	// setting table header columns
	//var colArr = json.columnNames;
	var colArr = Object.keys(json.results[0]);

	if(colArr.length > 0) {
		var $thead = $card.find('thead');
		var $tr = $('<tr></tr>');
		for(i=0; i<colArr.length; i++) {
			$tr.append('<th>'+colArr[i]+'</th>');
		}
		$thead.append($tr);

		// 입력폼에 항목 추가
		var input_template = '<div class="form-group"><label class="col-sm-2 control-label" for="input_id_{COLUMN}">{COLUMN}</label><div class="col-sm-10"><div class="fg-line"><input type="text" class="form-control input-sm" id="input_id_{COLUMN}" name="{COLUMN}" placeholder="{COLUMN}"></div></div></div>';
		for(i=colArr.length-1; i>=0; i--) {
			if(colArr[i] == 'seq' || colArr[i] == 'ipt_date')
				continue;
			$('#card_input .card-body').prepend(input_template.replaceAll('{COLUMN}', colArr[i].toUpperCase()));
		}
	}
	
	// 원래 table id 이름으로 찾아야 되지????
	var table = document.getElementsByTagName("table")[0];
	var tbody = table.getElementsByTagName("tbody")[0];
	tbody.onclick = function (e) {
    		e = e || window.event;
    		var data = [];
    		var target = e.srcElement || e.target;
    		while (target && target.nodeName !== "TR") {
        		target = target.parentNode;
    		}
    		if (target) {
        		var cells = target.getElementsByTagName("td");
        		
			for (var i = 0; i < cells.length; i++) {
            			data.push(cells[i].innerHTML);
        		}
    		}				
    		alert(data);
		//$('').val();
	};

	// 내용 추가
	var rowArr = json.results;
	if(rowArr.length > 0) {
		var $tbody = $card.find('tbody');
		for(i=0; i<rowArr.length; i++) {
			var $tr = $('<tr></tr>');
			var dataArr = rowArr[i];
			for(j=0; j<dataArr.length; j++) {
				$($tr).append('<td>'+dataArr[j]+'</td>');
			}
			$tbody.append($tr);
		}
	}

	//$container.append($card);
	$('#content .block-header').after( $card );
	$('#card_input').show();
	$('#insertBtn').click(function(event){
		var json = getJsonFromFormGroup( $('#card_input') );
		json['table_name'] = g_target_table;
		var str = JSON.stringify(json);
		console.log(str);
		str = Base64.encode(str);
		console.log(str);

		requestInsert(json, function(table, recv) {
			console.log(table + ','+recv);
			//alert(recv.count + '개의 레코드가 입력되었습니다.');
		});
	})
    
    $('#updateBtn').click(function(event){
		var json = getJsonFromFormGroup( $('#card_input') );
		json['table_name'] = g_target_table;
		var str = JSON.stringify(json);
		console.log(str);
		str = Base64.encode(str);
		console.log(str);

		requestUpdate(json, function(table, recv) {
			console.log(table + ','+recv);
			//alert(recv.count + '개의 레코드가 입력되었습니다.');
		});
	})
    
    $('#deleteBtn').click(function(event){
		var json = getJsonFromFormGroup( $('#card_input') );
		json['table_name'] = g_target_table;
		var str = JSON.stringify(json);
		console.log(str);
		str = Base64.encode(str);
		console.log(str);

		requestDelete(json, function(table, recv) {
			console.log(table + ','+recv);
			//alert(recv.count + '개의 레코드가 입력되었습니다.');
		});
	})
}

//function func(id) {
//	if(id == "")
//        	document.getElementById('drawer_user_id').innerHTML = 'default';   
//    	else document.getElementById('drawer_user_id').innerHTML = String(id);
//}

$(document).ready(function(){
  
    var token = getLocationParameter('token');
    if(token!="") g_token = token;

    var userid = getLocationParameter('id');
    
    if(userid == "")
        document.getElementById('drawer_user_id').innerHTML = 'default';   
    else{
	user_id = userid;
	document.getElementById('drawer_user_id').innerHTML = String(user_id);
    }

//    getUserInfoFromJson(func);
    
	var table = getLocationParameter('type');
	initMenu(table);
	
	if(table) {
		requestSelect(table, onCrud);
		return;
	}

	$('#btn_table_search').click(function(event){
		var targetTable = $('#sel_table_search').val();
		requestSelect(targetTable, onCrud);
	});

    $('#content .card').eq(0).show();
});
</script>
    
    
</html>


