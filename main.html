<!DOCTYPE html>

    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>Soma 2nd Project</title>
        
        <!-- Vendor CSS -->
        <link href="vendors/bootgrid/jquery.bootgrid.min.css" rel="stylesheet">
        <link href="vendors/bower_components/animate.css/animate.min.css" rel="stylesheet">
        <link href="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.css" rel="stylesheet">
        <link href="vendors/bower_components/material-design-iconic-font/dist/css/material-design-iconic-font.min.css" rel="stylesheet">
        <link href="vendors/bower_components/bootstrap-select/dist/css/bootstrap-select.css" rel="stylesheet">
        <link href="vendors/bower_components/nouislider/distribute/jquery.nouislider.min.css" rel="stylesheet">
        <link href="vendors/bower_components/lightgallery/light-gallery/css/lightGallery.css" rel="stylesheet">
        <link href="vendors/bower_components/summernote/dist/summernote.css" rel="stylesheet">
        <link href="vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/css/bootstrap-datetimepicker.min.css" rel="stylesheet">
        <link href="vendors/farbtastic/farbtastic.css" rel="stylesheet">
        <link href="vendors/chosen_v1.4.2/chosen.min.css" rel="stylesheet">
        <link href="vendors/bower_components/nouislider/distribute/jquery.nouislider.min.css" rel="stylesheet">
        
        <!-- CSS -->
        <link href="css/app.min.1.css" rel="stylesheet">
        <link href="css/app.min.2.css" rel="stylesheet">
    </head>

    <body>
        <header id="header">
            <ul class="header-inner">
                <li id="menu-trigger" data-trigger="#sidebar">
                    <div class="line-wrap">
                        <div class="line top"></div>
                        <div class="line center"></div>
                        <div class="line bottom"></div>
                    </div>
                </li>
            
                <li class="logo hidden-xs">
                    <a href="main.html">껨톡</a>
                </li>
                
                <li class="pull-right">
                    <ul class="top-menu">
                        <li id="top-search">
                            <a class="tm-search" href=""></a>
                        </li>
                        <li class="dropdown">
                            <a data-toggle="dropdown" class="tm-message" href=""><i class="tmn-counts">4</i></a>
                            <div class="dropdown-menu dropdown-menu-lg pull-right">
                                <div class="listview">
                                    <div class="lv-header">
                                        Messages
                                    </div>
                                    <div class="lv-body">
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/1.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">지영</div>
                                                    <small class="lv-small">팀원 1</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/2.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">한별</div>
                                                    <small class="lv-small">팀장</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/3.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">다현</div>
                                                    <small class="lv-small">팀원 2</small>
                                                </div>
                                            </div>
                                        </a>
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/4.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">경완</div>
                                                    <small class="lv-small">팀원 3</small>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <a class="lv-footer" href="">View More</a>
                                </div>
                            </div>
                        </li>
                        <li class="dropdown">
                            <a data-toggle="dropdown" class="tm-notification" href=""><i class="tmn-counts">1</i></a>
                            <div class="dropdown-menu dropdown-menu-lg pull-right">
                                <div class="listview" id="notifications">
                                    <div class="lv-header">
                                        Notification

                                        <ul class="actions">
                                            <li class="dropdown">
                                                <a href="" data-clear="notification">
                                                    <i class="zmdi zmdi-check-all"></i>
                                                </a>
                                            </li>
                                        </ul>
                                    </div>
                                    <div class="lv-body">
                                        <a class="lv-item" href="">
                                            <div class="media">
                                                <div class="pull-left">
                                                    <img class="lv-img-sm" src="img/profile-pics/2.jpg" alt="">
                                                </div>
                                                <div class="media-body">
                                                    <div class="lv-title">정원용 멘토님</div>
                                                    <small class="lv-small">프로젝트 화이팅!</small>
                                                </div>
                                            </div>
                                        </a>
                                    </div>
                                    <a class="lv-footer" href="">View Previous</a>
                                </div>
                            </div>
                        </li>
                        <li class="dropdown">
                            <a data-toggle="dropdown" class="tm-task" href=""></a>
                            <div class="dropdown-menu pull-right dropdown-menu-lg">
                                <div class="listview">    
                                    <div class="lv-header">
                                            Tasks
                                    </div>
                                    <div class="lv-body">
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">HTML5 Validation Report</div>

                                            <div class="progress">
                                                <div class="progress-bar" role="progressbar" aria-valuenow="95" aria-valuemin="0" aria-valuemax="100" style="width: 95%">
                                                    <span class="sr-only">95% Complete (success)</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Google Chrome Extension</div>

                                            <div class="progress">
                                                <div class="progress-bar progress-bar-success" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                                    <span class="sr-only">80% Complete (success)</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Social Intranet Projects</div>

                                            <div class="progress">
                                                <div class="progress-bar progress-bar-info" role="progressbar" aria-valuenow="20" aria-valuemin="0" aria-valuemax="100" style="width: 20%">
                                                    <span class="sr-only">20% Complete</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Bootstrap Admin Template</div>

                                            <div class="progress">
                                                <div class="progress-bar progress-bar-warning" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%">
                                                    <span class="sr-only">60% Complete (warning)</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="lv-item">
                                            <div class="lv-title m-b-5">Youtube Client App</div>
                                            <div class="progress">
                                                <div class="progress-bar progress-bar-danger" role="progressbar" aria-valuenow="80" aria-valuemin="0" aria-valuemax="100" style="width: 80%">
                                                    <span class="sr-only">80% Complete (danger)</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <a class="lv-footer" href="">View All</a>
                                </div>
                            </div>
                        </li> 
                        <li class="dropdown">
                            <a data-toggle="dropdown" class="tm-settings" href=""></a>
                            <ul class="dropdown-menu dm-icon pull-right">
                                <li class="hidden-xs">
                                    <a data-action="fullscreen" href=""><i class="zmdi zmdi-fullscreen"></i> Toggle Fullscreen</a>
                                </li>
                                <li>
                                    <a data-action="clear-localstorage" href=""><i class="zmdi zmdi-delete"></i> Clear Local Storage</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </li>
            </ul>
            
            <!-- Top Search Content -->
            <div id="top-search-wrap">
                <input type="text">
                <i id="top-search-close">&times;</i>
            </div>
        </header>
        
        <section id="main">
            <aside id="sidebar">
                <div class="sidebar-inner c-overflow">
                    <div class="profile-menu">
                        <a href="">
                            <div id="drawer_user_profile" class="profile-pic">
                                <img src="img/profile-pics/1.jpg" alt="">
                            </div>

                            <div id="drawer_user_id" class="profile-info">
                                <i class="zmdi zmdi-arrow-drop-down"></i>
                            </div>
                        </a>
                    </div>

                    <ul class="main-menu">
                        <li><a href="profile-about.html"><i class="zmdi zmdi-account"></i> View Profile</a></li>
                        <li class="sub-menu">
                            <a href=""><i class="zmdi zmdi-view-list"></i> Database Tables</a>
                            <ul id="menu-db-table">
                            </ul>
                        </li>
                        <li><a href="notice.html"><i class="zmdi zmdi-format-underlined"></i> Push Notification</a></li>
                        <li><a href="blacklist.html"><i class="zmdi zmdi-remote-control"></i> Black List</a></li>
                        <li><a href="wordfilter.html"><i class="zmdi zmdi-seat"></i> Word Filter</a></li>
                        <li><a href="traffic.html"><i class="zmdi zmdi-portable-wifi"></i> Server Traffic</a></li>
                        <li onclick="logout()"><a href=""><i class="zmdi zmdi-swap-alt"></i> Logout</a></li>
                    </ul>
                </div>
            </aside>
                        
            <section id="content">
                <div class="container">
                    <div class="block-header">
                        <h2>Table CRUD <small>CRUD : create / read / update / delete</small></h2>
                    </div>
                    <br/>
                    
                    <div class="card" id="card_main" style="display: none;">
                        <div class="card-header">
                            <h2>Select Application, First!!</h2>
                            <p class="c-gray">application을 선택한 후, channel 혹은 user를 선택해주세요.</p>
                        </div>

                        <div class="card-body card-padding">
                            <div class="row">
                                <div class="col-sm-3 m-b-15">
                                    <p class="c-darkgray f-500 m-b-20">Application</p>
                                    <div id="sel_app" class="select">
                                        <select class="selectpicker" title="Select Applicaions"></select>
                                    </div>
                                </div>
                                <div class="col-sm-3 m-b-15">
                                    <label id="radio_channel" class="radio radio-inline f-500 m-b-20">
                                        <input type="radio" name="tableRadio" value="channel" disabled="true">
                                        <i class="input-helper"></i>  
                                        Channel
                                    </label>
                                    <div id="sel_channel" class="select">
                                        <select class="selectpicker" title="Select Channels" disabled="true">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-3 m-b-15">
                                    <label id="radio_user" class="radio radio-inline f-500 m-b-20">
                                        <input type="radio" name="tableRadio" value="user" disabled="true">
                                        <i class="input-helper"></i>  
                                        User
                                    </label>
                                    <div id="sel_user" class="select">
                                        <select class="selectpicker" title="Select Users" disabled="true">
                                        </select>
                                    </div>
                                </div>
                                <div class="col-sm-3 m-b-15">
                                    <p class="c-white f-500 m-b-15">.</p>
                                    <button type="button" id="btn_table_search" class="btn btn-primary btn-sm m-t-5 fg-line">Search</button>
                                </div>
                            </div>
                        </div>
                    </div>
     
                    <div class="card" id="card_input" style="display: none;">
                        <div class="card-header">
                            <div class="row">
                                <div class="col-xs-6 col-md-8">
                                    <h5><big>데이터</big> 입력/수정/삭제</h5> 
                                </div>

                                <div class="col-xs-6 col-md-4">
                                    <div class="pull-right">
                                        <button id="emptyBtn" type="button" class="btn btn-primary btn-sm waves-effect" style="margin:3px">비우기</button> 
                                        <button id="insertBtn" type="button" class="btn btn-success btn-sm waves-effect" style="margin:3px">입력</button> 
                                        <button id="updateBtn" type="button" class="btn btn-warning btn-sm waves-effect" style="margin:3px">수정</button>
                                        <button id="deleteBtn" type="button" class="btn btn-danger btn-sm waves-effect" style="margin:3px">삭제</button>
                                    </div>
                                </div> 
                            </div>
                        </div>
                        <div class="table-responsive"></div>
                    </div>
                    
                    <div class="card" id="card_table">
                      <div class="table-responsive"></div>
                    </div>
                    
                </div>
            </section>
        </section>
        
        <footer id="footer">
            Software Maestro &copy; 2015년 1단계 2차 프로젝트

            <ul class="f-menu">
                <li><a href="">Home</a></li>
                <li><a href="">Dashboard</a></li>
                <li><a href="">Support</a></li>
                <li><a href="">Contact</a></li>
            </ul>
        </footer>
        
        
        <!-- Javascript Libraries -->
        <script src="vendors/bower_components/jquery/dist/jquery.min.js"></script>
        <script src="vendors/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>
        <script src="vendors/bower_components/jquery.nicescroll/jquery.nicescroll.min.js"></script>
        <script src="vendors/bower_components/Waves/dist/waves.min.js"></script>
        <script src="vendors/bower_components/bootstrap-sweetalert/lib/sweet-alert.min.js"></script>  
        <script src="vendors/bower_components/moment/min/moment.min.js"></script>
        <script src="vendors/bower_components/bootstrap-select/dist/js/bootstrap-select.js"></script>
        <script src="vendors/bower_components/nouislider/distribute/jquery.nouislider.all.min.js"></script>
        <script src="vendors/bower_components/summernote/dist/summernote.min.js"></script>
        <script src="vendors/bower_components/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js"></script>
        <script src="vendors/bower_components/typeahead.js/dist/typeahead.bundle.min.js"></script>
        <script src="vendors/bower_components/lightgallery/light-gallery/js/lightGallery.min.js"></script>
        <script src="vendors/bower_components/autosize/dist/autosize.min.js"></script>
        
        <script src="vendors/bootstrap-growl/bootstrap-growl.min.js"></script>
        <script src="vendors/bootgrid/jquery.bootgrid.min.js"></script>
        <script src="vendors/chosen_v1.4.2/chosen.jquery.min.js"></script>
        <script src="vendors/fileinput/fileinput.min.js"></script>
        <script src="vendors/input-mask/input-mask.min.js"></script>
        <script src="vendors/farbtastic/farbtastic.min.js"></script>
        
        <script src="js/functions.js"></script>
        <script src="js/demo.js"></script>
        
        <script src="js/crud.js"></script>

      
        <script type="text/javascript">
            $(document).ready(function(){

                var token = localStorage.getItem('user_token');
                if(token == "" | token == null) 
                    location.replace("login.html");
                
                var id = localStorage.getItem('user_id');
                document.getElementById('drawer_user_id').innerHTML = String(id);
                
                var table = getLocationParameter('type');
	            initMenu(table);
                
                if(table){
                    $('#card_main').hide();
                    $('#card_input').show();
                    requestSelect(table, onCrud);
                }else{
                    $('#card_main').show();
                    $('#card_input').hide();
                    
                    getAppList(function(json){
                        var arr = json.results;
                        var len = arr.length;
                        
                        if(len == 0)    return;
                        
                        for(var i=0; i<len; i++)
                        {
                            var $option = '<option>'+arr[i]+'</option>';
                            $('#sel_app .selectpicker').append($option);
                        }
                        $('#sel_app .selectpicker').selectpicker('refresh');   
                    });
                }
            
                $('#sel_app').bind('click', function(){
                    $('#radio_channel input:radio').prop('disabled', false);
                    $('#radio_user input:radio').prop('disabled', false);
                });
                
                $('#radio_user input:radio').bind('click', function(){
                    clickSelApp($(this));
                });
                
                $('#radio_channel input:radio').bind('click', function(){
                    clickSelApp($(this));
                });
                
                
                $('#btn_table_search').click(function() {
                    var app = $('#sel_app .selectpicker').val();  
                    var channel = $('#sel_channel .selectpicker').val();  
                    var user = $('#sel_user .selectpicker').val(); 
                    
                    if(app != null)
                    {
                        var query = '';
                        
                        if(!(user==null | user==""))
                        {    query = 'select * from app_user_list where app_id="'+app+'" and user_id="'+user+'"'; }
                        else if(!(channel==null | channel==""))
                        {    query = 'select * from channel where app_id="'+app+'" and channel_name="'+channel+'"'; }
                        else
                        {    query = 'select * from app_user_list where app_id="'+app+'"'; }
                        
                        requestByApp(query);
                    }
                });
                
            });
            
            function clickSelApp($this) 
            {
                // radio button & selector
                if($('#sel_app .selectpicker').val() != null)
                {
                    // 요거땜시 event가 계속 추가되어서 dropdown이 계속 배로 늘어남.
                    //$('input[type=radio][name=tableRadio]').on('change', function(){
                        switch($this.val()){
                            case 'user' :
                                $('#sel_channel .selectpicker').prop('disabled', true);
                                $('#sel_channel .selectpicker').val("").selectpicker('refresh');
                                $('#sel_user .selectpicker').prop('disabled', false).selectpicker('refresh');

                                getUserList($('#sel_app .selectpicker').val(), function(json){
                                    var arr = json.results;
                                    var len = arr.length;
                        
                                    if(len == 0){
                                        $('#sel_user .selectpicker').children().remove();
                                        $('#sel_user .selectpicker').selectpicker('refresh')
                                        return;
                                    }
                                    
                                    $('#sel_user .selectpicker').children().remove();
                                    for(var i=0; i<len; i++)
                                    {
                                        var $option = '<option>'+arr[i][0]+'</option>';
                                        $('#sel_user .selectpicker').append($option).selectpicker('refresh');
                                    }
                                });
                                break;

                            case 'channel' :
                                $('#sel_channel .selectpicker').prop('disabled', false).selectpicker('refresh');
                                $('#sel_user .selectpicker').val("");
                                $('#sel_user .selectpicker').prop('disabled', true).selectpicker('refresh');

                                getChannelList($('#sel_app .selectpicker').val(), function(json){
                                    var arr = json.results;
                                    var len = arr.length;
                        
                                    if(len == 0){
                                        $('#sel_channel .selectpicker').children().remove();
                                        $('#sel_channel .selectpicker').selectpicker('refresh')
                                        return;
                                    }
                                    
                                    $('#sel_channel .selectpicker').children().remove();
                                    for(var i=0; i<len; i++)
                                    {
                                        var $option = '<option>'+arr[i][0]+'</option>';
                                        $('#sel_channel .selectpicker').append($option);
                                    }
                                    $('#sel_channel .selectpicker').selectpicker('refresh');
                                });
                                break;
                        }            
                    //});
                }   
            }
        </script>
    </body>
  </html>
